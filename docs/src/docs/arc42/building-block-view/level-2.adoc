= Level 2

== IRS controller

The IRS REST Controller is used to provide a RESTful web service.

=== Component diagram

[plantuml, target=level-2-controller, format=svg]
....
include::../../../uml-diagrams/building-block-view/level-2-int.puml[]
....

=== Component description

|===
|Components |Description

|IrsController
|Application REST Controller.

|IrsItemGraphQueryService
|Item graph query service.

|JobOrchestrator
|Orchestrator service for recursive MultiTransferJobs, potentially involving multiple transfers.

|JobStore
|Spring configuration for job-related beans.

|BlobstorePersistence
|Interface for storing data blobs.
|===


== RecursiveJobHandler

The *RecursiveJobHandler* component provides the logic to build jobs with recursive logic to retrieve items across the entire C-X network and assembles the partial results into a single item graph result.

=== Component diagram

[plantuml, target=level-2-jobhandler, format=svg]
....
include::../../../uml-diagrams/building-block-view/level-2-int-recursive-job-handler.puml[]
....


=== Component description

|===
|Components |Description

|AASRecursiveJobHandler
|Recursive job handler for AAS data

|TreeRecursiveLogic
|Retrieves item graphs from potentially multiple calls to the IRS API behind multiple EDC providers, and assembles their outputs into one overall item graph.

|ItemTreesAssembler
|Assembles multiple partial item graphs into a single overall item graph.

|BlobPersistence
|Interface for storing data blobs.
|===


== TransferProcessManagement

The TransferProcessManager creates executions and provides them to the executor service. Each execution contains HTTP requests to the asset administration shell registry and to the submodel interface.

=== Component diagram
[plantuml, target=level-2-transfer-process-management, format=svg]
....
include::../../../uml-diagrams/building-block-view/level-2-int-transfer-process-management.puml[]
....

=== Component description

|===
|Components |Description

|TransferProcessManager
|The TransferProcessManager manages requests to the EDC and DigitalTwinRegistry.

|DigitalTwinRegistryFacade
|The DigitalTwinRegistryFacade calls the DigitalTwinRegistry to retrieve data from the AAS registry and transforms the response into internal data models.

|SubmodelFacade
|The SubmodelFacade handles the EDC contract negotiation and is responsible for the EDC dataplane requests to retrieve data from the submodel servers.

|BlobStore
|The BlobStore is the database that stores the relationships and tombstones for a requested item.

|DigitalTwinRegistry
|The DigitalTwinRegistry is the central database for registered assets. In a decentralized network, the registry is no longer central, but each provider has its own registry.

|ExecutorService
|The ExecutorService enables simultaneous execution of transfer processes.
|===

== ESS controller

The ESS REST Controller is used to provide a RESTful web service to related Environmental and Social Standards functionality.

=== Component diagram

[plantuml, target=level-2-ess-controller, format=svg]
....
include::../../../uml-diagrams/building-block-view/level-2-int-ess.puml[]
....

=== Component description

|===
|Components |Description

|EssService
|Service contains business logic for investigating whether a part is in the supply chain.

|IrsItemGraphQueryService
|Service to retrieve item graph.

|BpnInvestigationJobCache
|Interface for storing incident data blobs.

|EssRecursiveNotificationHandler
|Business logic that handles recursive investigation and result calculation. Responsible for sending and receiving EDC notifications.
|===